<NeemPlugin type="extra" name="File Upload">
	
	<default:setting id="keystrokeCommand" value="up-" />
	<default:setting id="uploadServer" value="http://localhost/work/neem/service/neemUpload/upload_file.php" />
	
	<variable:set name="flags" value="is" />
 	
	<keyCommand:add id="resultCommand" command="{thisPlugin.getSetting('keystrokeCommand')}">
		
		<change:property target="{resultCommand}" replacement="tp{Math.round(Math.random()*9999)}" />
		
		<FileReference instance:id="browsePhotos" />
		
		<observer:listen to="{browsePhotos}" for="select" limit="1">
			
			<!--add the browser to the queue now since the photo is uploading -->
			<run script="{model.progressModel.addItem(browsePhotos,'progress',DataEvent.UPLOAD_COMPLETE_DATA)}" />
			
			<observer:listen id="tpResult" to="{browsePhotos}" for="{DataEvent.UPLOAD_COMPLETE_DATA}" limit="1">
				<XML instance:id="result" xml="{tpResult.event.data}" />
				<condition:check if="{result.mediaurl}">
					<change:property target="{resultCommand}" replacement="{result.mediaurl}" />
				</condition:check>
			</observer:listen>
			
			<URLRequest instance:id="req" url="{thisPlugin.getSetting('uploadServer')}"  />
			
			<run script="{browsePhotos.upload(req)}" />
			
		</observer:listen>
		
		<Array instance:id="{filter}">
			<FileFilter description="select a photo to upload" filter="*.*;" />
		</Array>
			
		<run script="{browsePhotos.browse(filter)}" />
		
	</keyCommand:add>
	
	
	<view:preference name="File Upload" category="Extra">
		<View>
			<VBox percentWidth="100" percentHeight="100">
				<Label x="10" y="10" text="File Upload" style:fontSize="20"/>
				<Text  y="48" text="File uploaded is provided by Get Spicy. It enables you to upload anything you want to a server. the result is posted as a tinyurl and sent back." height="116" percentWidth="100" />
				<Form percentWidth="100" percentHeight="100">
					<FormItem label="Command:">
						<TextInput instance:id="newCommand"  text="{thisPlugin.getSetting('keystrokeCommand')}" />
					</FormItem>
					<FormItem label="Server:">
						<TextInput instance:id="newServer"  text="{thisPlugin.getSetting('uploadServer')}" />
					</FormItem>
					<FormItem>
						<Button instance:id="saveButton" label="save"  observer:click="thisPlugin.saveSetting('keystrokeCommand',newCommand.text);thisPlugin.saveSetting('uploadServer',newServer.text);" />
					</FormItem>
				</Form>
				
			</VBox>
		</View>
	</view:preference>
	
</NeemPlugin>