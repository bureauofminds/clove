<NeemPlugin type="extra" name="Translate">
	
	<default:setting id="keystrokeCommand" value="-translate" />
	<default:setting id="primaryLanguage" value="en" />
	
	<variable:set name="flags" value="is" />
 	
	<keyCommand:add id="resultCommand" command="{thisPlugin.getSetting('keystrokeCommand')}">
		
		<!-- remove the shrink -->
		<change:property target="{resultCommand}" replacement="" />
		
		<!-- set the target text to shrink -->
		<change:property target="{resultCommand}" targetText="{resultCommand.text}" />
		
		<URLLoader instance:id="translateLoader" />
		
		<observer:listen to="{translateLoader}" for="complete" limit="1">
			<run script="{var result = JSON.decode(translateLoader.data)}" />
			
			<run script="{trace(translateLoader.data)}" />
			<condition:check if="{result.responseData.translatedText}">
				<change:property target="{resultCommand}" replacement="{result.responseData.translatedText}" />
			</condition:check>
			<condition:else>
				<!-- fail -->
			</condition:else>
		</observer:listen>
		
		<String instance:id="toLanguage" value="es" />
		
		<call:function target="{trace}">
			<String value="http://ajax.googleapis.com/ajax/services/language/translate?v=1.0&q={resultCommand.text}&langpair={thisPlugin.getSetting('primaryLanguage')}%7C{toLanguage}" />
		</call:function>
		
		<call:function target="{translateLoader.load}">
			<URLRequest url="http://ajax.googleapis.com/ajax/services/language/translate?v=1.0&q={resultCommand.text}&langpair={thisPlugin.getSetting('primaryLanguage')}%7C{toLanguage}" />
		</call:function>
	</keyCommand:add>
	
	
	<view:preference name="Translate" category="Extra">
		<View>
			<VBox percentWidth="100" percentHeight="100">
				<Label x="10" y="10" text="Translate" style:fontSize="20"/>
				<Text  y="48" text="Translate any text" height="116" percentWidth="100" />
				<Form percentWidth="100" percentHeight="100">
					<FormItem label="Command:">
						<TextInput instance:id="newCommand"  text="{thisPlugin.getSetting('keystrokeCommand')}" />
					</FormItem>
					<FormItem>
						<Button instance:id="saveButton" label="save"  observer:click="thisPlugin.saveSetting('keystrokeCommand',newCommand.text);" />
					</FormItem>
				</Form>
				
			</VBox>
		</View>
	</view:preference>
	
</NeemPlugin>